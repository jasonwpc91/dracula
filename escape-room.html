<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dracula's Castle — Enhanced</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Nosifer&family=Chiller&display=swap');
    
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      overflow: hidden;
      position: relative;
      cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><text x="0" y="15" font-size="16">🦇</text></svg>'), auto;
    }

    /* Animated background effects */
    .fog {
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at center, rgba(128, 128, 128, 0.1) 0%, transparent 70%);
      animation: drift 20s ease-in-out infinite alternate;
      z-index: 1;
    }

    .lightning {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0);
      z-index: 2;
      pointer-events: none;
    }

    .lightning.flash {
      animation: lightningFlash 0.3s ease-out;
    }

    @keyframes lightningFlash {
      0% { background: rgba(255, 255, 255, 0); }
      20% { background: rgba(135, 206, 235, 0.3); }
      100% { background: rgba(255, 255, 255, 0); }
    }

    @keyframes drift {
      0% { transform: translateX(-10px); opacity: 0.3; }
      100% { transform: translateX(10px); opacity: 0.1; }
    }

    h1 { 
      margin: 15px 0; 
      color: #ff3333; 
      font-family: 'Nosifer', cursive;
      font-size: 2.5em;
      text-shadow: 0 0 20px rgba(255, 51, 51, 0.8), 0 0 40px rgba(255, 51, 51, 0.4);
      z-index: 10;
      position: relative;
      animation: pulse 3s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { text-shadow: 0 0 20px rgba(255, 51, 51, 0.8), 0 0 40px rgba(255, 51, 51, 0.4); }
      50% { text-shadow: 0 0 30px rgba(255, 51, 51, 1), 0 0 60px rgba(255, 51, 51, 0.6); }
    }

    #countdown { 
      font-size: 32px; 
      margin: 15px 0; 
      font-family: 'Creepster', cursive;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      z-index: 10;
      position: relative;
    }

    #arena {
      display: flex;
      justify-content: space-between;
      width: 85%;
      margin-top: 80px;
      position: relative;
      height: 420px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 20px;
      backdrop-filter: blur(5px);
      border: 2px solid rgba(128, 128, 128, 0.2);
      z-index: 5;
      padding: 20px;
      box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.5);
    }

    #dracula {
      position: absolute;
      font-size: 64px;
      left: 50%;
      top: 8px;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.5s;
      z-index: 30;
      pointer-events: none;
      filter: drop-shadow(0 0 15px rgba(255, 0, 0, 0.8));
      animation: draculaFloat 3s ease-in-out infinite;
    }

    @keyframes draculaFloat {
      0%, 100% { transform: translateX(-50%) translateY(0px); }
      50% { transform: translateX(-50%) translateY(-5px); }
    }

    #speech {
      position: absolute;
      font-size: 16px;
      color: #ff5555;
      text-align: center;
      opacity: 0;
      transition: opacity 0.4s;
      z-index: 40;
      pointer-events: none;
      white-space: nowrap;
      background: rgba(0, 0, 0, 0.8);
      padding: 8px 15px;
      border-radius: 20px;
      border: 1px solid #ff5555;
      font-family: 'Chiller', cursive;
      text-shadow: 0 0 6px rgba(255, 85, 85, 0.8);
      box-shadow: 0 0 20px rgba(255, 85, 85, 0.3);
    }

    /* Speech bubble tail */
    #speech::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 8px solid transparent;
      border-top-color: #ff5555;
    }

    .side { 
      display: flex; 
      flex-direction: column; 
      gap: 25px;
      z-index: 10;
    }

    .room {
      width: 140px;
      height: 100px;
      border: 3px solid #666;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><text x="0" y="15" font-size="16">👻</text></svg>'), pointer;
      background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
      position: relative;
      overflow: hidden;
      border-radius: 15px;
      z-index: 10;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.1);
      font-size: 14px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    }

    .room::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 49%, rgba(128, 128, 128, 0.1) 50%, transparent 51%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    /* Door effect */
    .room::after {
      content: '🚪';
      position: absolute;
      font-size: 24px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.3;
      z-index: -1;
    }

    .room:hover { 
      background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
      transform: translateY(-3px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      border-color: #888;
    }

    .room:hover::before {
      opacity: 1;
    }

    .selected { 
      border-color: #ffd700; 
      background: linear-gradient(145deg, #4a4a2a, #3a3a1a);
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.5), 0 8px 16px rgba(0, 0, 0, 0.4);
      animation: selectedPulse 2s ease-in-out infinite;
    }

    @keyframes selectedPulse {
      0%, 100% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.5), 0 8px 16px rgba(0, 0, 0, 0.4); }
      50% { box-shadow: 0 0 35px rgba(255, 215, 0, 0.8), 0 8px 16px rgba(0, 0, 0, 0.4); }
    }

    .room.selected::before {
      content: '';
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
      border-radius: 15px;
      z-index: -1;
      animation: selectedShimmer 2s linear infinite;
    }

    @keyframes selectedShimmer {
      0% { background-position: 0% 0%; }
      100% { background-position: 100% 100%; }
    }

    .opened { 
      border-color: #ff3333; 
      background: linear-gradient(145deg, #660000, #440000);
      animation: openedShake 0.5s ease-out, openedGlow 2s ease-in-out infinite alternate;
    }

    .opened::after {
      opacity: 0.1 !important;
    }

    @keyframes openedShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    @keyframes openedGlow {
      0% { box-shadow: 0 0 20px rgba(255, 51, 51, 0.6), 0 8px 16px rgba(0, 0, 0, 0.4); }
      100% { box-shadow: 0 0 40px rgba(255, 51, 51, 1), 0 8px 16px rgba(0, 0, 0, 0.4); }
    }

    #player {
      font-size: 42px;
      position: absolute;
      top: 60%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: all 2000ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
      z-index: 20;
      pointer-events: none;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.6));
      animation: playerIdle 4s ease-in-out infinite;
    }

    @keyframes playerIdle {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.05); }
    }

    .blood {
      position: absolute;
      font-size: 36px;
      top: 15%;
      left: 30%;
      opacity: 0;
      transition: opacity 0.5s, transform 0.5s;
      pointer-events: none;
      filter: drop-shadow(0 0 8px rgba(255, 0, 0, 0.8));
      animation: bloodDrip 2s ease-in-out infinite;
    }

    @keyframes bloodDrip {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(3px); }
    }

    #result { 
      font-size: 28px; 
      margin-top: 25px; 
      z-index: 10;
      position: relative;
      font-family: 'Creepster', cursive;
      text-shadow: 0 0 10px currentColor;
      animation: resultFadeIn 0.8s ease-out;
    }

    @keyframes resultFadeIn {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    button { 
      margin-top: 25px; 
      padding: 15px 30px; 
      font-size: 18px; 
      cursor: pointer; 
      border: none; 
      border-radius: 12px; 
      background: linear-gradient(145deg, #ff3333, #cc1111);
      color: #fff;
      font-family: 'Creepster', cursive;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      z-index: 10;
      position: relative;
    }

    button:hover {
      background: linear-gradient(145deg, #ff5555, #dd2222);
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    /* Floating bats animation */
    .bat {
      position: absolute;
      font-size: 20px;
      opacity: 0.6;
      animation: flyBat 15s linear infinite;
      z-index: 3;
      pointer-events: none;
    }

    @keyframes flyBat {
      0% { transform: translateX(-50px) translateY(0px) rotate(0deg); }
      25% { transform: translateX(25vw) translateY(-20px) rotate(5deg); }
      50% { transform: translateX(50vw) translateY(10px) rotate(-5deg); }
      75% { transform: translateX(75vw) translateY(-15px) rotate(3deg); }
      100% { transform: translateX(calc(100vw + 50px)) translateY(5px) rotate(0deg); }
    }

    /* Glowing moon */
    .moon {
      position: absolute;
      top: 20px;
      right: 50px;
      width: 60px;
      height: 60px;
      background: radial-gradient(circle, #ffffcc 30%, #ffff99 60%, rgba(255, 255, 153, 0.3) 100%);
      border-radius: 50%;
      box-shadow: 0 0 30px rgba(255, 255, 204, 0.8), 0 0 60px rgba(255, 255, 204, 0.4);
      z-index: 3;
      animation: moonGlow 4s ease-in-out infinite alternate;
    }

    @keyframes moonGlow {
      0% { box-shadow: 0 0 30px rgba(255, 255, 204, 0.8), 0 0 60px rgba(255, 255, 204, 0.4); }
      100% { box-shadow: 0 0 40px rgba(255, 255, 204, 1), 0 0 80px rgba(255, 255, 204, 0.6); }
    }

    /* Castle silhouette */
    .castle {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 15%;
      background: linear-gradient(to top, #000000 0%, #222222 80%, transparent 100%);
      z-index: 2;
      opacity: 0.7;
    }

    .castle::before {
      content: '';
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 60%;
      background: repeating-linear-gradient(
        to right,
        #000 0px, #000 20px,
        #111 20px, #111 25px,
        #000 25px, #000 45px,
        #222 45px, #222 50px
      );
    }

    /* Torch effect for rooms */
    .room-torch {
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 12px;
      animation: torchFlicker 1.5s ease-in-out infinite alternate;
    }

    @keyframes torchFlicker {
      0% { opacity: 0.6; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1.1); }
    }

    /* Room labels */
    .room-label {
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: #ccc;
      font-family: 'Chiller', cursive;
    }

    /* Sound wave effect */
    .sound-wave {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #ff5555;
      border-radius: 50%;
      opacity: 0;
      z-index: 35;
    }

    .sound-wave.active {
      animation: soundWave 1s ease-out;
    }

    @keyframes soundWave {
      0% { 
        transform: scale(1);
        opacity: 1;
      }
      100% { 
        transform: scale(20);
        opacity: 0;
      }
    }

    /* Blood splatter effect */
    .blood-drop {
      position: absolute;
      width: 8px;
      height: 8px;
      background: #ff0000;
      border-radius: 50%;
      animation: bloodSplatter 0.6s ease-out;
    }

    @keyframes bloodSplatter {
      0% { 
        transform: scale(0) rotate(0deg);
        opacity: 0;
      }
      50% {
        transform: scale(1.5) rotate(180deg);
        opacity: 1;
      }
      100% { 
        transform: scale(1) rotate(360deg);
        opacity: 0.8;
      }
    }

    /* Additional animations */
    @keyframes sparkle {
      0% { opacity: 0; transform: scale(0) rotate(0deg); }
      50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
      100% { opacity: 0; transform: scale(0.8) rotate(360deg); }
    }
      
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
  </style>
</head>
<body>
  <!-- Background effects -->
  <div class="fog"></div>
  <div class="lightning"></div>
  <div class="moon"></div>
  <div class="castle"></div>

  <!-- Flying bats -->
  <div class="bat" style="top: 15%; animation-delay: 0s;">🦇</div>
  <div class="bat" style="top: 25%; animation-delay: -5s;">🦇</div>
  <div class="bat" style="top: 35%; animation-delay: -10s;">🦇</div>

  <h1>🧛‍♂️ Escape Dracula's Castle</h1>
  <div id="countdown">Game starting in 10...</div>

  <div id="arena">
    <div id="dracula">🧛‍♂️</div>
    <div id="speech"></div>

    <div class="side" id="left-side">
      <div class="room" data-room="L1">
        <div class="room-label">Dungeon</div>
        <div class="room-torch">🔥</div>
        Library
        <div class="blood">🩸</div>
      </div>
      <div class="room" data-room="L2">
        <div class="room-label">Tower</div>
        <div class="room-torch">🔥</div>
        Bedroom
        <div class="blood">🩸</div>
      </div>
      <div class="room" data-room="L3">
        <div class="room-label">Cellar</div>
        <div class="room-torch">🔥</div>
        Kitchen
        <div class="blood">🩸</div>
      </div>
    </div>

    <div class="side" id="right-side">
      <div class="room" data-room="R1">
        <div class="room-label">Balcony</div>
        <div class="room-torch">🔥</div>
        Throne Room
        <div class="blood">🩸</div>
      </div>
      <div class="room" data-room="R2">
        <div class="room-label">Attic</div>
        <div class="room-torch">🔥</div>
        Armory
        <div class="blood">🩸</div>
      </div>
      <div class="room" data-room="R3">
        <div class="room-label">Crypt</div>
        <div class="room-torch">🔥</div>
        Great Hall
        <div class="blood">🩸</div>
      </div>
    </div>

    <div id="player">🏃‍♀️</div>
  </div>

  <div id="result"></div>
  <button onclick="restartGame()">🔄 New Game</button>

  <script>
    const arena = document.getElementById('arena');
    const countdownEl = document.getElementById('countdown');
    const resultEl = document.getElementById('result');
    const draculaEl = document.getElementById('dracula');
    const speechEl = document.getElementById('speech');
    const rooms = Array.from(document.querySelectorAll('.room'));
    const playerEl = document.getElementById('player');
    const lightning = document.querySelector('.lightning');

    let countdown = 10;
    let selectedRoom = null;
    let gameActive = true;
    let timer = null;

    // Enhanced Dracula quotes
    const draculaQuotes = [
      "I can smell your mortal blood...",
      "Your fear feeds my eternal hunger...",
      "Run little mortal... it amuses me...",
      "The shadows whisper your location...",
      "Your heartbeat echoes through my castle...",
      "Death comes on silent wings...",
      "No prayer can save you now...",
      "Welcome to my eternal domain...",
      "Your soul will join my collection..."
    ];

    const DRACULA_MOVE_MS = 6000;

    // Enhanced room selection with effects
    rooms.forEach(room => {
      room.addEventListener('click', () => {
        if (!gameActive || countdown <= 0 || selectedRoom) return;
        
        // Sound effect simulation
        createSoundWave(room);
        
        rooms.forEach(r => r.classList.remove('selected'));
        room.classList.add('selected');
        selectedRoom = room;

        // Enhanced player movement
        const roomRect = room.getBoundingClientRect();
        const arenaRect = arena.getBoundingClientRect();
        const targetX = roomRect.left - arenaRect.left + roomRect.width / 2;
        const targetY = roomRect.top - arenaRect.top + roomRect.height / 2;

        // Add walking animation to player
        playerEl.style.animation = 'none';
        playerEl.style.left = `${targetX}px`;
        playerEl.style.top = `${targetY + 30}px`;

        setTimeout(() => {
          if (!selectedRoom) return;
          room.appendChild(playerEl);
          playerEl.style.position = 'absolute';
          playerEl.style.left = '50%';
          playerEl.style.top = '60%';
          playerEl.style.transform = 'translate(-50%, -50%)';
          playerEl.style.animation = 'playerIdle 4s ease-in-out infinite';
        }, 2000);
      });

      // Add hover effect with torch flicker
      room.addEventListener('mouseenter', () => {
        const torch = room.querySelector('.room-torch');
        if (torch) {
          torch.style.animation = 'torchFlicker 0.3s ease-in-out infinite alternate';
        }
      });
    });

    startCountdown();

    function startCountdown() {
      countdown = 10;
      countdownEl.textContent = `Game starting in ${countdown}...`;
      if (timer) clearInterval(timer);
      
      timer = setInterval(() => {
        countdown--;
        countdownEl.textContent = `Game starting in ${countdown}...`;
        
        // Add tension effects as countdown gets lower
        if (countdown <= 3) {
          countdownEl.style.color = '#ff3333';
          countdownEl.style.animation = 'pulse 0.5s ease-in-out infinite';
        }
        
        if (countdown <= 0) {
          clearInterval(timer);
          countdownEl.textContent = '⚡ Dracula awakens! ⚡';
          countdownEl.style.color = '#ff0000';
          triggerLightning();
          setTimeout(wakeDracula, 500);
        }
      }, 1000);
    }

    function triggerLightning() {
      lightning.classList.add('flash');
      setTimeout(() => {
        lightning.classList.remove('flash');
      }, 300);
    }

    function createSoundWave(element) {
      const rect = element.getBoundingClientRect();
      const arenaRect = arena.getBoundingClientRect();
      
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          const wave = document.createElement('div');
          wave.className = 'sound-wave active';
          wave.style.left = `${rect.left - arenaRect.left + rect.width / 2}px`;
          wave.style.top = `${rect.top - arenaRect.top + rect.height / 2}px`;
          arena.appendChild(wave);
          
          setTimeout(() => wave.remove(), 1000);
        }, i * 200);
      }
    }

    async function wakeDracula() {
      draculaEl.style.opacity = 1;
      
      // Random lightning while Dracula hunts
      const lightningInterval = setInterval(() => {
        if (Math.random() < 0.3) triggerLightning();
      }, 2000);

      const n = Math.floor(Math.random() * 4) + 1;
      const shuffled = rooms.slice().sort(() => 0.5 - Math.random());
      const opened = shuffled.slice(0, n);

      for (const r of opened) {
        await moveDraculaToRoom(r, DRACULA_MOVE_MS);

        r.classList.add('opened');
        createBloodSplatter(r);

        if (selectedRoom && r === selectedRoom) {
          const blood = r.querySelector('.blood');
          if (blood) {
            blood.style.opacity = 1;
            // Add death effect
            playerEl.textContent = '💀';
            playerEl.style.animation = 'none';
          }
        }
        await sleep(500);
      }

      clearInterval(lightningInterval);
      showResult(opened);
    }

    function createBloodSplatter(room) {
      for (let i = 0; i < 8; i++) {
        setTimeout(() => {
          const drop = document.createElement('div');
          drop.className = 'blood-drop';
          drop.style.left = `${Math.random() * 100}%`;
          drop.style.top = `${Math.random() * 100}%`;
          room.appendChild(drop);
          setTimeout(() => drop.remove(), 600);
        }, i * 100);
      }
    }

    function moveDraculaToRoom(room, durationMs) {
      return new Promise(resolve => {
        const roomRect = room.getBoundingClientRect();
        const arenaRect = arena.getBoundingClientRect();

        const draculaW = draculaEl.offsetWidth || 64;
        const draculaH = draculaEl.offsetHeight || 64;
        const targetLeft = roomRect.left - arenaRect.left + (roomRect.width / 2) - (draculaW / 2);
        const targetTop = roomRect.top - arenaRect.top - draculaH - 10;

        // Enhanced speech with sound waves
        const quote = draculaQuotes[Math.floor(Math.random() * draculaQuotes.length)];
        speechEl.textContent = `"${quote}"`;
        speechEl.style.opacity = 1;
        
        // Create sound waves when speaking
        createSoundWave(draculaEl);

        repositionSpeech();
        const followInterval = setInterval(repositionSpeech, 50);

        // Enhanced movement with easing
        draculaEl.style.transition = `left ${durationMs}ms cubic-bezier(0.25, 0.46, 0.45, 0.94), top ${durationMs}ms cubic-bezier(0.25, 0.46, 0.45, 0.94)`;
        draculaEl.style.left = `${targetLeft}px`;
        draculaEl.style.top = `${targetTop}px`;

        // Random lightning during movement
        const lightningTimer = setTimeout(() => {
          if (Math.random() < 0.5) triggerLightning();
        }, durationMs / 2);

        setTimeout(() => {
          speechEl.style.opacity = 0;
        }, Math.max(1200, durationMs / 3));

        setTimeout(() => {
          clearInterval(followInterval);
          clearTimeout(lightningTimer);
          repositionSpeech();
          speechEl.style.opacity = 0;
          resolve();
        }, durationMs + 20);
      });
    }

    function repositionSpeech() {
      const arenaRect = arena.getBoundingClientRect();
      const dracRect = draculaEl.getBoundingClientRect();
      const centerX = dracRect.left - arenaRect.left + dracRect.width / 2;
      const topY = dracRect.top - arenaRect.top;
      speechEl.style.left = `${centerX}px`;
      speechEl.style.top = `${Math.max(0, topY - 45)}px`;
      speechEl.style.transform = 'translateX(-50%)';
    }

    function showResult(openedRooms) {
      setTimeout(() => {
        if (selectedRoom && openedRooms.includes(selectedRoom)) {
          resultEl.innerHTML = '💀 <span style="font-family: Nosifer, cursive;">DRACULA FOUND YOU!</span>';
          resultEl.style.color = '#ff3333';
          resultEl.style.animation = 'pulse 1s ease-in-out infinite';
          triggerLightning();
          // Screenshake effect
          document.body.style.animation = 'shake 0.5s ease-in-out';
        } else if (selectedRoom) {
          resultEl.innerHTML = '🎉 <span style="font-family: Creepster, cursive;">YOU ESCAPED THE CASTLE!</span>';
          resultEl.style.color = '#00ff88';
          resultEl.style.animation = 'resultFadeIn 0.8s ease-out';
          // Celebration effect
          createCelebration();
        } else {
          resultEl.innerHTML = '😐 <span style="font-family: Chiller, cursive;">You were too scared to hide...</span>';
          resultEl.style.color = '#ffaa00';
        }
      }, 500);
      
      gameActive = false;
    }

    function createCelebration() {
      for (let i = 0; i < 20; i++) {
        setTimeout(() => {
          const sparkle = document.createElement('div');
          sparkle.textContent = ['✨', '🌟', '⭐'][Math.floor(Math.random() * 3)];
          sparkle.style.position = 'absolute';
          sparkle.style.left = `${Math.random() * 100}%`;
          sparkle.style.top = `${Math.random() * 100}%`;
          sparkle.style.fontSize = '24px';
          sparkle.style.opacity = '0';
          sparkle.style.animation = 'sparkle 2s ease-out';
          sparkle.style.zIndex = '50';
          sparkle.style.pointerEvents = 'none';
          document.body.appendChild(sparkle);
          
          setTimeout(() => sparkle.remove(), 2000);
        }, i * 100);
      }
    }

    function sleep(ms) { 
      return new Promise(r => setTimeout(r, ms)); 
    }

    function restartGame() {
      // Reset all animations
      document.body.style.animation = '';
      countdownEl.style.color = '#fff';
      countdownEl.style.animation = '';
      
      gameActive = true;
      selectedRoom = null;
      resultEl.textContent = '';
      resultEl.style.animation = '';
      draculaEl.style.opacity = 0;
      draculaEl.style.left = '50%';
      draculaEl.style.top = '8px';
      draculaEl.style.transition = 'opacity 0.5s';
      speechEl.style.opacity = 0;

      // Reset rooms with stagger effect
      rooms.forEach((r, index) => {
        setTimeout(() => {
          r.classList.remove('selected', 'opened');
          const blood = r.querySelector('.blood');
          if (blood) blood.style.opacity = 0;
          
          // Remove any blood drops
          const drops = r.querySelectorAll('.blood-drop');
          drops.forEach(drop => drop.remove());
        }, index * 100);
      });

      // Reset player with flourish
      arena.appendChild(playerEl);
      playerEl.textContent = '🏃‍♀️';
      playerEl.style.position = 'absolute';
      playerEl.style.left = `${arena.clientWidth / 2}px`;
      playerEl.style.top = `${arena.clientHeight * 0.6}px`;
      playerEl.style.transform = 'translate(-50%, -50%)';
      playerEl.style.animation = 'playerIdle 4s ease-in-out infinite';

      setTimeout(startCountdown, 500);
    }

    // Enhanced initialization
    function init() {
      playerEl.style.left = `${arena.clientWidth / 2}px`;
      playerEl.style.top = `${arena.clientHeight * 0.6}px`;
      
      // Add random lightning flashes during gameplay
      setInterval(() => {
        if (Math.random() < 0.1) triggerLightning();
      }, 3000);
      
      // Add ambient sound wave effects
      setInterval(() => {
        if (gameActive && Math.random() < 0.3) {
          const randomRoom = rooms[Math.floor(Math.random() * rooms.length)];
          if (!randomRoom.classList.contains('opened')) {
            setTimeout(() => createSoundWave(randomRoom), Math.random() * 1000);
          }
        }
      }, 5000);
    }

    // Initialize game
    init();
  </script>
</body>
</html>